<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fastmate - ë‹¹ì‹ ì˜ ë‹¨ì‹ ë™ë°˜ì</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
    <script src="./firebase-init.js"></script>
  
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');

        :root {
          color-scheme: light; 
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --text-light: #777;
            --border-color: #e0e0e0;
            --primary-color: #1c8e3e; /* ê¸°ì¡´ gauge-end-colorë¥¼ ë©”ì¸ ì»¬ëŸ¬ë¡œ ì‚¬ìš© */
            --primary-hover: #156a2f;
            --gauge-start-color: #ffd400;
            --gauge-track-color: #f6f3e7;
            --dark-gray-color: #6c757d;
            --dark-gray-hover: #5a6268;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 420px;
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 8px G30px rgba(0, 0, 0, 0.1);
            padding: 25px;
            box-sizing: border-box;
            position: relative;
        }

        .user-chip {
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 9999px;
            background: #ffffff;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 18px rgba(0,0,0,0.08);
            font-weight: 600;
            font-size: .9rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .user-chip:hover { background-color: #f8f9fa; }
        .user-chip svg { width: 18px; height: 18px; stroke: var(--text-light); }


        .main-title {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 1.8rem;
        }

        .ring-wrap {
            position: relative;
            width: 80%;
            max-width: 300px;
            margin: 20px auto;
            aspect-ratio: 1 / 1;
        }

        .ring { width: 100%; height: 100%; }
        
        .timer-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .timer-display .label { font-size: 1rem; color: var(--text-light); }
        .timer-display .time { font-size: 2.5rem; font-weight: 700; color: var(--text-color); line-height: 1.2; }

        .status-message {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-light);
            margin: 10px 0 20px 0;
            min-height: 25px;
        }
        
        .time-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        .time-box {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            position: relative;
        }
        #startTimeBox {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #startTimeBox:hover {
            background-color: #e9ecef;
        }
        .time-box .label {
            font-size: 0.9rem;
            color: var(--text-light);
            display: block;
            margin-bottom: 5px;
        }
        .time-box .value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-color);
        }
        .edit-icon {
            position: absolute;
            top: 8px;
            right: 8px;
            stroke: #adb5bd;
            width: 16px;
            height: 16px;
        }

        .salt-tip { background-color: #fffbe6; border: 1px solid #ffe58f; color: #d46b08; padding: 12px; border-radius: 8px; font-size: 0.9rem; margin: 0 auto 20px auto; max-width: 90%; text-align: center; display: none; }

        .controls { display: flex; flex-direction: column; gap: 15px; align-items: center; }
        select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); font-size: 1rem; background-color: #f8f9fa; }
        .button-group { display: flex; gap: 10px; width: 100%; }
        .button-group button {
            flex-grow: 1;
            flex-basis: 0;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .start-btn { background-color: var(--primary-color); color: white; }
        .start-btn:hover { background-color: var(--primary-hover); }
        .stop-btn { background-color: var(--dark-gray-color); color: white; }
        .stop-btn:hover { background-color: var(--dark-gray-hover); }

        .bottom-nav { 
            border-top: 1px solid var(--border-color); 
            margin-top: 25px; 
            padding-top: 15px; 
            display: flex;
            justify-content: space-around;
        }
        .nav-btn { 
            background: none; 
            border: none;
            padding: 5px;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 5px; 
            font-size: 0.8rem; 
            font-weight: 500;
            color: var(--text-light); 
            cursor: pointer;
            transition: color 0.2s;
            flex-basis: 0;
            flex-grow: 1;
        }
        .nav-btn:hover {
            color: var(--primary-color);
        }
        .nav-btn svg { 
            width: 28px; 
            height: 28px; 
            stroke: currentColor; 
        }

        .app-footer {
            text-align: center;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        .app-footer a, .app-footer p {
            font-size: 0.8rem;
            color: var(--text-light);
            text-decoration: none;
            margin: 5px 0;
        }
        .app-footer a:hover {
            text-decoration: underline;
        }
        
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 16px;
            position: fixed;
            z-index: 2000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 1rem;
            opacity: 0;
            transition: opacity 0.5s, bottom 0.5s;
        }
        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }

        /* --- ì˜¨ë³´ë”© ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ì‹œì‘ --- */
        #appShield {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5); /* ë°˜íˆ¬ëª… ê²€ì€ ë°°ê²½ */
            z-index: 2000;
            display: none; /* í‰ì†Œì—” ìˆ¨ê¹€ */
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }

        #onboardingModal {
            width: 100%;
            max-width: 420px;
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 16px 60px rgba(0,0,0,.2);
            border: 1px solid var(--border-color);
            text-align: left;
        }

        .onb-title {
            margin: 0 0 8px 0;
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.5rem;
        }
        .onb-desc {
            margin: 0 0 24px 0;
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .onb-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .onb-input {
            width: 100%;
            padding: 14px 16px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: #f8f9fa;
            font-size: 1rem;
            outline: none;
            transition: box-shadow .15s, border-color .15s;
            box-sizing: border-box;
        }
        .onb-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(28,142,62,.12);
        }

        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tag {
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .tag.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: 700;
        }

        .onb-actions {
            display: flex;
            gap: 10px;
            margin-top: 24px;
        }
        .onb-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .onb-primary {
            background: var(--primary-color);
            color: #fff;
        }
        .onb-primary:hover {
            background: var(--primary-hover);
        }
        .onb-ghost {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }
        .onb-ghost:hover {
            background-color: #f8f9fa;
        }
        /* --- ì˜¨ë³´ë”© ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ë --- */

    </style>
</head>
<body>

    <!-- ì•± ë©”ì¸ ì»¨í…ì¸  -->
    <div class="container">
        <div id="userChip" class="user-chip" style="display:none">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <span id="userChipName">-</span>ë‹˜
        </div>

        <h1 class="main-title">fastmate</h1>
        
        <div class="ring-wrap">
            <svg class="ring" viewBox="0 0 120 120">
                <defs>
                    <linearGradient id="trackGrad"><stop stop-color="var(--gauge-track-color)"/></linearGradient>
                    <linearGradient id="progGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="var(--gauge-start-color)"/>
                        <stop offset="100%" stop-color="var(--primary-color)"/>
                    </linearGradient>
                </defs>
                <circle cx="60" cy="60" r="54" stroke="url(#trackGrad)" stroke-width="12" fill="none"/>
                <circle id="progressArc" cx="60" cy="60" r="54" stroke="url(#progGrad)" stroke-width="12" fill="none" stroke-linecap="round" pathLength="100" stroke-dasharray="0 100" transform="rotate(-90 60 60)"/>
            </svg>
            <div class="timer-display">
                <div class="label">ë‚¨ì€ ì‹œê°„</div>
                <div id="remainingTime" class="time">00:00:00</div>
            </div>
        </div>

        <div id="status-message" class="status-message">ë‹¨ì‹ ê³„íšì„ ì„ íƒí•˜ê³  ì‹œì‘í•˜ì„¸ìš”.</div>

        <div class="time-info">
            <div id="startTimeBox" class="time-box" title="í´ë¦­í•˜ì—¬ ì‹œê°„ ë³€ê²½">
                <span class="label">ì‹œì‘ ì‹œê°„</span>
                <span id="startTimeValue" class="value">-</span>
                <svg class="edit-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
            </div>
            <div class="time-box">
                <span class="label">ì¢…ë£Œ ì˜ˆì •</span>
                <span id="endTimeValue" class="value">-</span>
            </div>
        </div>
        
        <div id="salt-tip" class="salt-tip">ğŸ’¡ <strong>íŒ:</strong> 48ì‹œê°„ ì´ìƒ ì¥ê¸° ë‹¨ì‹ ì‹œì—ëŠ” ë¯¸ë„¤ë„ ë³´ì¶©ì„ ìœ„í•´ ì•½ê°„ì˜ ì†Œê¸ˆì„ ì„­ì·¨í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</div>

        <div class="controls">
            <select id="fastingModelSelect">
                <option value="16">16:8 (16ì‹œê°„ ë‹¨ì‹)</option>
                <option value="18">18:6 (18ì‹œê°„ ë‹¨ì‹)</option>
                <option value="20">20:4 (20ì‹œê°„ ë‹¨ì‹)</option>
                <option value="24">24ì‹œê°„ (1ì¼ ë‹¨ì‹)</option>
                <option value="36">36ì‹œê°„ (1.5ì¼ ë‹¨ì‹)</option>
                <option value="48">48ì‹œê°„ (2ì¼ ë‹¨ì‹)</option>
                <option value="72">72ì‹œê°„ (3ì¼ ë‹¨ì‹)</option>
            </select>
            <div class="button-group">
                <button id="startBtn" class="start-btn">ë‹¨ì‹ ì‹œì‘</button>
                <button id="stopBtn" class="stop-btn">ë‹¨ì‹ ì¢…ë£Œ</button>
            </div>
        </div>

        <div class="bottom-nav">
            <button class="nav-btn" id="myPageBtn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                <span>ë§ˆì´í˜ì´ì§€</span>
            </button>
            <button class="nav-btn" id="bloodSugarBtn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>
                <span>í˜ˆë‹¹ ê¸°ë¡</span>
            </button>
            <button class="nav-btn" id="ketoneBtn">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M12 2v20"/><path d="M7 7h10"/><path d="M7 17h10"/></svg>
  <span>ì¼€í†¤ ê¸°ë¡</span>
</button>

<button class="nav-btn" id="exerciseBtn">
     <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             viewBox="0 0 24 24" width="28" height="28" aria-hidden="true">
          <path d="M6 6v12M18 6v12"/>
          <path d="M3 10v4M21 10v4"/>
          <path d="M6 12h12"/>
        </svg>`;
  <span>ìš´ë™ ê¸°ë¡</span>
</button>
        </div>

        <!-- ì¼€í†¤ ê¸°ë¡ ëª¨ë‹¬ -->
<div id="ketoneModal" style="display:none; position:fixed; inset:0; z-index:1900; background:rgba(0,0,0,.5); align-items:center; justify-content:center; padding:20px; box-sizing:border-box;">
  <div style="width:100%; max-width:420px; background:var(--card-bg); border:1px solid var(--border-color); border-radius:16px; box-shadow:0 16px 60px rgba(0,0,0,.2); padding:24px;">
    <h3 class="onb-title" style="margin-bottom:8px;">ì¼€í†¤ ê¸°ë¡</h3>
    <p class="onb-desc">ì¼€í†¤ ìˆ˜ì¹˜(mmOL/L)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
    <input id="ketoneInput" class="onb-input" type="number" step="0.1" min="0" placeholder="ì˜ˆ. 1.2" />
    <div class="onb-actions" style="margin-top:20px;">
      <button type="button" data-close="ketoneModal" class="onb-btn onb-ghost">ì·¨ì†Œ</button>
      <button id="saveKetoneBtn" type="button" class="onb-btn onb-primary">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- ìš´ë™ ê¸°ë¡ ëª¨ë‹¬ -->
<div id="exerciseModal" style="display:none; position:fixed; inset:0; z-index:1900; background:rgba(0,0,0,.5); align-items:center; justify-content:center; padding:20px; box-sizing:border-box;">
  <div style="width:100%; max-width:420px; background:var(--card-bg); border:1px solid var(--border-color); border-radius:16px; box-shadow:0 16px 60px rgba(0,0,0,.2); padding:24px;">
    <h3 class="onb-title" style="margin-bottom:8px;">ìš´ë™ ê¸°ë¡</h3>
    <p class="onb-desc">ìš´ë™ ì¢…ë¥˜ì™€ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>

    <!-- í˜ˆë‹¹ ê¸°ë¡ ëª¨ë‹¬ -->
<div id="bloodSugarModal" style="display:none; position:fixed; inset:0; z-index:1900; background:rgba(0,0,0,.5); align-items:center; justify-content:center; padding:20px; box-sizing:border-box;">
  <div style="width:100%; max-width:420px; background:var(--card-bg); border:1px solid var(--border-color); border-radius:16px; box-shadow:0 16px 60px rgba(0,0,0,.2); padding:24px;">
    <h3 class="onb-title" style="margin-bottom:8px;">í˜ˆë‹¹ ê¸°ë¡</h3>
    <p class="onb-desc">í˜ˆë‹¹ ìˆ˜ì¹˜(mg/dL)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
    <input id="bloodSugarInput" class="onb-input" type="number" step="1" min="1" placeholder="ì˜ˆ. 92" />
    <div class="onb-actions" style="margin-top:20px;">
      <button type="button" data-close="bloodSugarModal" class="onb-btn onb-ghost">ì·¨ì†Œ</button>
      <button id="saveBloodSugarBtn" type="button" class="onb-btn onb-primary">ì €ì¥</button>
    </div>
  </div>
</div>

    <!-- ê¸°ì¡´ íƒœê·¸ ìŠ¤íƒ€ì¼ ì¬ì‚¬ìš© -->
    <div id="exerciseType" class="tag-cloud" style="margin-bottom:12px;">
      <button type="button" class="tag" data-value="ê±·ê¸°">ê±·ê¸°</button>
      <button type="button" class="tag" data-value="ë‹¬ë¦¬ê¸°">ë‹¬ë¦¬ê¸°</button>
      <button type="button" class="tag" data-value="ìš”ê°€">ìš”ê°€</button>
      <button type="button" class="tag" data-value="ê·¼ë ¥ìš´ë™">ê·¼ë ¥ìš´ë™</button>
      <button type="button" class="tag" data-value="ìˆ˜ì˜">ìˆ˜ì˜</button>
      <button type="button" class="tag" data-value="ìì „ê±°">ìì „ê±°</button>
      <button type="button" class="tag" data-value="ë“±ì‚°">ë“±ì‚°</button>
      <button type="button" class="tag" data-value="ì¤„ë„˜ê¸°">ì¤„ë„˜ê¸°</button>
      <button type="button" class="tag" data-value="í•„ë¼í…ŒìŠ¤">í•„ë¼í…ŒìŠ¤</button>
      <button type="button" class="tag" data-value="ëŒ„ìŠ¤">ëŒ„ìŠ¤</button>
      <button type="button" class="tag" data-value="íƒ€ë°”íƒ€">íƒ€ë°”íƒ€</button>
      <button type="button" class="tag" data-value="ê¸°íƒ€">ê¸°íƒ€</button>
    </div>

    <input id="exerciseDuration" class="onb-input" type="number" min="1" placeholder="ìš´ë™ ì‹œê°„(ë¶„)" style="margin-bottom:10px;" />
    <input id="exerciseCalories" class="onb-input" type="number" min="0" placeholder="ì†Œëª¨ ì¹¼ë¡œë¦¬(kcal, ì„ íƒ)" />

    <div class="onb-actions" style="margin-top:20px;">
      <button type="button" data-close="exerciseModal" class="onb-btn onb-ghost">ì·¨ì†Œ</button>
      <button id="saveExerciseBtn" type="button" class="onb-btn onb-primary">ì €ì¥</button>
    </div>
  </div>
</div>

        <footer class="app-footer">
            <a href="#" id="privacyPolicyLink">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
            <p>Â© 2025 2e-studio. All rights reserved.</p>
        </footer>
    </div>
    
    <!-- ì˜¨ë³´ë”© ëª¨ë‹¬ (í™”ë©´ ì „ì²´ë¥¼ ë®ëŠ” ë°°ê²½ í¬í•¨) -->
    <div id="appShield">
        <div id="onboardingModal">
            <h3 class="onb-title">ì²˜ìŒ ì˜¤ì…¨êµ°ìš”! ğŸ‘‹</h3>
            <p class="onb-desc">fastmateì˜ ëª¨ë“  ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë‹‰ë„¤ì„ê³¼ ê°€ì… ëª©ì ì„ ì•Œë ¤ì£¼ì„¸ìš”.</p>
    
            <label class="onb-label" for="onbNickname">ë‹‰ë„¤ì„</label>
            <input id="onbNickname" class="onb-input" type="text" placeholder="ì˜ˆ.ê±´ê°•í•œ ë¼ì´ì–¸" />
    
            <label class="onb-label" style="margin-top: 20px;">ê°€ì… ëª©ì  (1ê°œ ì´ìƒ ì„ íƒ)</label>
            <div id="onbGoals" class="tag-cloud">
                <button type="button" class="tag" data-value="ì²´ì¤‘ê´€ë¦¬">ì²´ì¤‘ê´€ë¦¬</button>
                <button type="button" class="tag" data-value="í˜ˆë‹¹ ê´€ë¦¬">í˜ˆë‹¹ê´€ë¦¬</button>
                <button type="button" class="tag" data-value="ìê°€í¬ì‹(ì˜¤í† íŒŒì§€)">ìê°€í¬ì‹(ì˜¤í† íŒŒì§€)</button>
                <button type="button" class="tag" data-value="ìœ„ì¥íœ´ì‹Â·ì†Œí™”ê°œì„ ">ìœ„ì¥íœ´ì‹Â·ì†Œí™”ê°œì„ </button>
                <button type="button" class="tag" data-value="ì—ë„ˆì§€Â·ì§‘ì¤‘ë ¥ ê°œì„ ">ì—ë„ˆì§€Â·ì§‘ì¤‘ë ¥ ê°œì„ </button>
                <button type="button" class="tag" data-value="ê¸°íƒ€">ê¸°íƒ€</button>
            </div>
    
            <div class="onb-actions">
                <button id="onbCancel" type="button" class="onb-btn onb-ghost">ë‚˜ì¤‘ì— í• ê²Œìš”</button>
                <button id="onbSave" type="button" class="onb-btn onb-primary">ì €ì¥í•˜ê³  ì‹œì‘</button>
            </div>
        </div>
    </div>

    <!-- Toast Alert -->
    <div id="toast"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  /* =========================
   * 0) ì¸ì¦ ê°€ë“œ + ì˜¨ë³´ë”© ì²´í¬
   *   - ë¡œê·¸ì¸ ì—†ìœ¼ë©´ login.html
   *   - ë‹‰ë„¤ì„/ëª©ì  ì—†ìœ¼ë©´ signup.html Step2ë¡œ
   * ========================= */
  let bootstrapped = false;
 auth.onAuthStateChanged(async (user) => {
  if (!user) {
    window.location.href = './login.html';
    return;
  }

  // ì´ë¯¸ í•œ ë²ˆ signupìœ¼ë¡œ ë³´ëƒˆë‹¤ë©´ ê°™ì€ ì„¸ì…˜ì—ì„œëŠ” ë˜ ì•ˆ ë³´ëƒ„
  if (sessionStorage.getItem('onboardingLock') === '1') {
    // ì´ ìƒíƒœì—ì„  ì•±ë§Œ ì´ˆê¸°í™”í•˜ê³  ì‚¬ìš©ìê°€ signupì—ì„œ ë§ˆë¬´ë¦¬í•˜ë„ë¡ ë‘ê¸°
    initializeTimePicker();
    initializeTime();
    loadState();
    wireEventsOnce();
    return;
  }

  // í”„ë¡œí•„ í™•ì¸
  const prof = await getUserDoc().catch(() => null);
  const completed = !!prof?.onboarding?.completed;
  const hasNickname = !!prof?.nickname;
  const hasGoals = Array.isArray(prof?.onboarding?.reasons) && prof.onboarding.reasons.length > 0;

  if (!completed || !hasNickname || !hasGoals) {
    // í•œë²ˆë§Œ ë³´ëƒ„
    sessionStorage.setItem('onboardingLock', '1');
    window.location.href = './signup.html?step=2&from=fastmate';
    return;
  }


    if (bootstrapped) return;
    bootstrapped = true;

    try {
      const prof = await getUserDoc(); // users/{uid}
      const nickname = prof?.nickname || user.displayName || (user.email ? user.email.split('@')[0] : null);
      const reasons  = prof?.onboarding?.reasons;

      // ìƒë‹¨ ì¹© 1íšŒ ì„¸íŒ…(ë°˜ì§ì„ ë°©ì§€)
      const chip = document.getElementById('userChip');
      const chipName = document.getElementById('userChipName');
      if (chip && chipName) {
        chipName.textContent = nickname || 'íšŒì›';
        chip.style.display = 'flex';
        chip.onclick = () => (window.location.href = './mypage.html');
      }

      // ë‹‰ë„¤ì„/ëª©ì  ì—†ìœ¼ë©´ ëª¨ë‹¬ ëŒ€ì‹  íšŒì›ê°€ì… 2~3ë‹¨ê³„ë¡œ ìœ ë„
      const needsOnboarding = !nickname || !Array.isArray(reasons) || reasons.length === 0;
      if (needsOnboarding) {
        sessionStorage.setItem('onboardingRedirectFrom', 'fastmate');
        window.location.href = './signup.html?step=2&from=fastmate';
        return;
      }

      // ì´ˆê¸°í™”
      initializeTimePicker();
      initializeTime();
      loadState();
      wireEventsOnce();
    } catch (e) {
      console.error(e);
      initializeTimePicker();
      initializeTime();
      loadState();
      wireEventsOnce();
    }
  });

  /* =========================
   * 1) DOM ìºì‹œ
   * ========================= */
  const progressArc      = document.getElementById('progressArc');
  const remainingTimeEl  = document.getElementById('remainingTime');
  const statusMessage    = document.getElementById('status-message');
  const saltTip          = document.getElementById('salt-tip');

  const startBtn         = document.getElementById('startBtn');
  const stopBtn          = document.getElementById('stopBtn');
  const modelSelect      = document.getElementById('fastingModelSelect');

  const startTimeBox     = document.getElementById('startTimeBox');
  const startTimeValue   = document.getElementById('startTimeValue');
  const endTimeValue     = document.getElementById('endTimeValue');

  // ì‹œê°„ ì„ íƒ ëª¨ë‹¬(ìˆìœ¼ë©´ ë™ì‘)
  const timePickerModal  = document.getElementById('timePickerModal');
  const dayBeforeBtn     = document.getElementById('dayBeforeBtn');
  const todayBtn         = document.getElementById('todayBtn');
  const hourSelect       = document.getElementById('hourSelect');
  const minuteSelect     = document.getElementById('minuteSelect');
  const ampmSelect       = document.getElementById('ampmSelect');
  const saveTimeBtn      = document.getElementById('saveTimeBtn');

  // ëª©í‘œ ë³€ê²½ í™•ì¸ ëª¨ë‹¬(ìˆìœ¼ë©´ ë™ì‘)
  const confirmChangeModal = document.getElementById('confirmChangeModal');
  const confirmMessage     = document.getElementById('confirmMessage');
  const confirmYesBtn      = document.getElementById('confirmYesBtn');
  const confirmNoBtn       = document.getElementById('confirmNoBtn');

  // ë„¤ë¹„/ì…ë ¥ ëª¨ë‹¬
  const myPageBtn        = document.getElementById('myPageBtn');
  const bloodSugarBtn    = document.getElementById('bloodSugarBtn');
  const ketoneBtn        = document.getElementById('ketoneBtn');
  const exerciseBtn      = document.getElementById('exerciseBtn');

  const bloodSugarModal  = document.getElementById('bloodSugarModal');
  const saveBloodSugarBtn= document.getElementById('saveBloodSugarBtn');
  const bloodSugarInput  = document.getElementById('bloodSugarInput');

  const ketoneModal      = document.getElementById('ketoneModal');
  const saveKetoneBtn    = document.getElementById('saveKetoneBtn');
  const ketoneInput      = document.getElementById('ketoneInput');

  const exerciseModal    = document.getElementById('exerciseModal');
  const exerciseTypeWrap = document.getElementById('exerciseType');
  const exerciseDuration = document.getElementById('exerciseDuration');
  const exerciseCalories = document.getElementById('exerciseCalories');
  const saveExerciseBtn  = document.getElementById('saveExerciseBtn');

  const privacyPolicyLink= document.getElementById('privacyPolicyLink');
  const toast            = document.getElementById('toast');

  /* =========================
   * 2) ìƒíƒœ/ìœ í‹¸
   * ========================= */
  let fastingInterval  = null;
  let targetHours      = 16;
  let fastingState     = 'idle'; // 'idle' | 'running'
  let selectedStartTime= new Date();
  let pendingTargetHours = null;
  let toastTimeout     = null;
  const milestones = { 10:false, 25:false, 50:false, 70:false, 80:false, 90:false };

  const db = firebase.firestore();

  function showToast(msg) {
    if (!toast) return;
    clearTimeout(toastTimeout);
    toast.textContent = msg;
    toast.classList.add('show');
    toastTimeout = setTimeout(() => toast.classList.remove('show'), 1800);
  }
  function saveLocalList(key, data) {
    const arr = JSON.parse(localStorage.getItem(key) || '[]');
    arr.unshift(data);
    localStorage.setItem(key, JSON.stringify(arr));
  }
  function ensureSignedIn() {
    const user = auth?.currentUser;
    if (!user) {
      showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      window.location.href = './login.html';
      return null;
    }
    return user;
  }

  /* =========================
   * 3) ë‹¨ì‹ íƒ€ì´ë¨¸
   * ========================= */
  function updateTimeDisplays() {
    const start = selectedStartTime;
    const duration = parseInt(modelSelect.value || targetHours, 10);
    const end = new Date(start.getTime() + duration * 3600000);
    const fmt = (d) =>
      `${d.getMonth()+1}/${d.getDate()} ${d.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true})}`;
    if (startTimeValue) startTimeValue.textContent = fmt(start);
    if (endTimeValue)   endTimeValue.textContent   = fmt(end);
  }

  function updateUIState() {
    const running = fastingState === 'running';
    if (startBtn) {
      startBtn.disabled = running;
      startBtn.textContent = running ? 'ë‹¨ì‹ì¤‘' : 'ë‹¨ì‹ ì‹œì‘';
      startBtn.style.backgroundColor = running ? 'var(--gauge-start-color)' : 'var(--primary-color)';
      startBtn.style.color = running ? 'var(--text-color)' : '#fff';
    }
    if (stopBtn) {
      stopBtn.disabled = !running;
      stopBtn.style.opacity = running ? '1' : '0.5';
    }
    if (startTimeBox) {
      startTimeBox.style.pointerEvents = running ? 'none' : 'auto';
    }
  }

  function checkMilestones(progress) {
    const messages = {
      10:"ì‹œì‘ì´ ë°˜! ë¬¼ í•œ ì”ìœ¼ë¡œ ëª¸ì„ ê¹¨ì›Œì£¼ì„¸ìš”. ğŸ’§",
      25:"25% ë‹¬ì„±! ìˆœì¡°ë¡­ê²Œ ì§„í–‰ ì¤‘ì´ì—ìš”.",
      50:"ì ˆë°˜ì´ë‚˜ ì™”ì–´ìš”! ì •ë§ ëŒ€ë‹¨í•´ìš”. ì‹œì›í•œ ë¬¼ í•œ ì” ìŠì§€ ë§ˆì„¸ìš”! ğŸ’§",
      70:"ê±°ì˜ ë‹¤ ì™”ìŠµë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ë” í˜ë‚´ì„¸ìš”!",
      90:"90% ëŒíŒŒ! ëª©í‘œê°€ ë°”ë¡œ ëˆˆì•ì— ìˆì–´ìš”. í™”ì´íŒ…! ğŸ’§"
    };
    Object.keys(milestones).forEach((p) => {
      const pi = parseInt(p,10);
      if (progress >= pi && !milestones[p]) {
        showToast(messages[p]);
        milestones[p] = true;
      }
    });
  }

  function updateTimer() {
    const now = new Date();
    const elapsed = now - selectedStartTime;
    const target  = targetHours * 3600000;
    const progress = Math.min((elapsed / target) * 100, 100);

    if (progressArc) progressArc.style.strokeDasharray = `${progress} 100`;

    const remain = Math.max(0, target - elapsed);
    const h = Math.floor(remain / 3600000);
    const m = Math.floor((remain % 3600000) / 60000);
    const s = Math.floor((remain % 60000) / 1000);
    if (remainingTimeEl) remainingTimeEl.textContent =
      `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;

    if (statusMessage) {
      statusMessage.textContent =
        (elapsed / 3600000) >= 16 ? "ì„¸í¬ ì¬í™œìš©, ì˜¤í† íŒŒì§€ í™œì„±í™” ì¤‘!" : "ë‹¨ì‹ ì§„í–‰ ì¤‘...";
    }

    checkMilestones(progress);
    if (progress >= 100) showToast("ëª©í‘œ ë‹¬ì„±! ì¶•í•˜í•©ë‹ˆë‹¤!");
  }

  function startFasting() {
    if (fastingState === 'running') return showToast("ì´ë¯¸ ë‹¨ì‹ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.");
    fastingState = 'running';
    targetHours = parseInt(modelSelect.value, 10);
    localStorage.setItem('fastingStartTime', selectedStartTime.toISOString());
    localStorage.setItem('fastingTargetHours', targetHours);
    Object.keys(milestones).forEach(k=> milestones[k]=false);

    if (saltTip) saltTip.style.display = targetHours >= 48 ? 'block' : 'none';
    fastingInterval = setInterval(updateTimer, 1000);
    updateTimer();
    updateUIState();
  }

  async function stopFasting() {
    if (fastingState === 'idle') return showToast("ì‹œì‘ëœ ë‹¨ì‹ì´ ì—†ìŠµë‹ˆë‹¤.");
    clearInterval(fastingInterval);
    fastingState = 'idle';

    const record = {
      startTime: selectedStartTime.toISOString(),
      endTime: new Date().toISOString(),
      targetHours,
      actualDurationHours: (new Date() - selectedStartTime) / 3600000
    };

    // Local ì €ì¥
    saveLocalList('fastingHistoryData', record);

    // Firestore ì €ì¥ (fastingHistory)
    try {
      const user = ensureSignedIn(); if (!user) return;
      await db.collection('users').doc(user.uid)
        .collection('fastingHistory')
        .add({
          startTime: new Date(record.startTime),
          endTime: new Date(record.endTime),
          targetHours: record.targetHours,
          actualDurationHours: record.actualDurationHours,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
    } catch (e) {
      console.error('save fasting history failed:', e);
    }

    // UI ì´ˆê¸°í™”
    localStorage.removeItem('fastingStartTime');
    localStorage.removeItem('fastingTargetHours');
    if (progressArc)      progressArc.style.strokeDasharray = '0 100';
    if (remainingTimeEl)  remainingTimeEl.textContent = '00:00:00';
    if (statusMessage)    statusMessage.textContent = 'ë‹¨ì‹ ê³„íšì„ ì„ íƒí•˜ê³  ì‹œì‘í•˜ì„¸ìš”.';
    if (saltTip)          saltTip.style.display = 'none';
    if (endTimeValue)     endTimeValue.textContent = '-';

    selectedStartTime = new Date();
    updateTimeDisplays();
    updateUIState();
    showToast("ë‹¨ì‹ì„ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤. ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!");
  }

  function handleModelChange(e) {
    const newTarget = parseInt(e.target.value, 10);
    if (fastingState === 'running' && newTarget !== targetHours) {
      pendingTargetHours = newTarget;
      if (confirmChangeModal && confirmMessage) {
        confirmMessage.textContent = `ë‹¨ì‹ ëª©í‘œë¥¼ ${targetHours}ì‹œê°„ì—ì„œ ${newTarget}ì‹œê°„ìœ¼ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
        confirmChangeModal.style.display = 'flex';
      }
      e.target.value = targetHours;
    } else if (fastingState !== 'running') {
      targetHours = newTarget;
      updateTimeDisplays();
    }
  }

  /* =========================
   * 4) ì‹œê°„ ì„ íƒ ì´ˆê¸°í™”
   * ========================= */
  function initializeTimePicker() {
    if (!timePickerModal) return;
    // ì‹œ/ë¶„ ì˜µì…˜
    hourSelect.innerHTML = '';
    for (let i=1;i<=12;i++) hourSelect.innerHTML += `<option value="${i}">${i}</option>`;
    minuteSelect.innerHTML = '';
    for (let i=0;i<60;i++) minuteSelect.innerHTML += `<option value="${i}">${String(i).padStart(2,'0')}</option>`;

    startTimeBox?.addEventListener('click', () => {
      if (fastingState === 'running') return;
      const now = selectedStartTime;
      let h = now.getHours();
      const ampm = h>=12 ? 'PM' : 'AM';
      h = h%12; h = h ? h : 12;
      hourSelect.value = h;
      minuteSelect.value = now.getMinutes();
      ampmSelect.value = ampm;
      timePickerModal.style.display = 'flex';
    });

    dayBeforeBtn?.addEventListener('click', () => {
      dayBeforeBtn.classList.add('active'); todayBtn.classList.remove('active');
    });
    todayBtn?.addEventListener('click', () => {
      todayBtn.classList.add('active'); dayBeforeBtn.classList.remove('active');
    });

    saveTimeBtn?.addEventListener('click', () => {
      let hour = parseInt(hourSelect.value,10);
      const minute = parseInt(minuteSelect.value,10);
      const isPM = ampmSelect.value === 'PM';
      if (isPM && hour < 12) hour += 12;
      if (!isPM && hour === 12) hour = 0;

      const newDate = new Date();
      if (dayBeforeBtn?.classList.contains('active')) newDate.setDate(newDate.getDate()-1);
      newDate.setHours(hour, minute, 0, 0);
      selectedStartTime = newDate;
      updateTimeDisplays();
      timePickerModal.style.display = 'none';
    });
  }

  function initializeTime() {
    selectedStartTime = new Date();
    updateTimeDisplays();
  }

  function loadState() {
    const savedStart = localStorage.getItem('fastingStartTime');
    const savedHours = localStorage.getItem('fastingTargetHours');
    if (savedStart && savedHours) {
      const start = new Date(savedStart);
      const hrs   = parseInt(savedHours,10);
      if ((new Date() - start) < hrs*3600000) {
        selectedStartTime = start;
        targetHours = hrs;
        modelSelect.value = hrs;
        fastingState = 'running';
        if (saltTip) saltTip.style.display = targetHours >= 48 ? 'block' : 'none';
        fastingInterval = setInterval(updateTimer,1000);
        updateTimer();
      } else {
        localStorage.removeItem('fastingStartTime');
        localStorage.removeItem('fastingTargetHours');
      }
    }
    updateTimeDisplays();
    updateUIState();
  }

  /* =========================
   * 5) ì´ë²¤íŠ¸ ë°”ì¸ë”© (1íšŒ)
   * ========================= */
  let eventsWired = false;
  function wireEventsOnce() {
    if (eventsWired) return;
    eventsWired = true;

    startBtn?.addEventListener('click', startFasting);
    stopBtn?.addEventListener('click', stopFasting);
    modelSelect?.addEventListener('change', handleModelChange);

    confirmYesBtn?.addEventListener('click', () => {
      if (pendingTargetHours == null) return;
      targetHours = pendingTargetHours; pendingTargetHours = null;
      modelSelect.value = targetHours;
      localStorage.setItem('fastingTargetHours', targetHours);
      updateTimeDisplays(); updateTimer();
      if (saltTip) saltTip.style.display = targetHours >= 48 ? 'block' : 'none';
      showToast("ë‹¨ì‹ ëª©í‘œê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
      confirmChangeModal.style.display = 'none';
    });
    confirmNoBtn?.addEventListener('click', () => {
      modelSelect.value = targetHours;
      confirmChangeModal.style.display = 'none';
    });

    myPageBtn?.addEventListener('click', () => {
      window.location.href = './mypage.html';
    });

    // --- í˜ˆë‹¹ ê¸°ë¡ ---
    bloodSugarBtn?.addEventListener('click', () => {
      if (bloodSugarModal) {
        bloodSugarModal.style.display = 'flex';
      } else {
        const v = parseFloat(prompt('í˜ˆë‹¹ ìˆ˜ì¹˜ (mg/dL)ë¥¼ ì…ë ¥í•˜ì„¸ìš”:') || '');
        if (v > 0) {
          saveLocalList('bloodSugarData', { date:new Date().toISOString(), value:v });
          showToast('í˜ˆë‹¹ ìˆ˜ì¹˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
      }
    });
    saveBloodSugarBtn?.addEventListener('click', async () => {
      const v = parseFloat(bloodSugarInput?.value);
      if (!v || v<=0) return showToast("ì˜¬ë°”ë¥¸ í˜ˆë‹¹ ìˆ˜ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

      const user = ensureSignedIn(); if (!user) return;

      // ë¡œì»¬
      saveLocalList('bloodSugarData', { date:new Date().toISOString(), value:v });

      // Firestore
      try {
        await db.collection('users').doc(user.uid)
          .collection('measurements').doc('bloodSugar')
          .collection('items').add({
            date: new Date(),
            value: v,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
      } catch (e) {
        console.error('save blood sugar failed:', e);
        showToast('ì„œë²„ ì €ì¥ ì‹¤íŒ¨(í˜ˆë‹¹)â€¦ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }

      bloodSugarInput.value = '';
      bloodSugarModal.style.display = 'none';
      showToast("í˜ˆë‹¹ ìˆ˜ì¹˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });

    // --- ì¼€í†¤ ê¸°ë¡ ---
    ketoneBtn?.addEventListener('click', () => ketoneModal && (ketoneModal.style.display='flex'));
    saveKetoneBtn?.addEventListener('click', async () => {
      const v = parseFloat(ketoneInput?.value);
      if (v == null || isNaN(v) || v < 0) return showToast("ì˜¬ë°”ë¥¸ ì¼€í†¤ ìˆ˜ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

      const user = ensureSignedIn(); if (!user) return;

      // ë¡œì»¬
      saveLocalList('ketoneData', { date:new Date().toISOString(), value:v });

      // Firestore
      try {
        await db.collection('users').doc(user.uid)
          .collection('measurements').doc('ketone')
          .collection('items').add({
            date: new Date(),
            value: v,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
      } catch (e) {
        console.error('save ketone failed:', e);
        showToast('ì„œë²„ ì €ì¥ ì‹¤íŒ¨(ì¼€í†¤)â€¦ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }

      ketoneInput.value = '';
      ketoneModal.style.display = 'none';
      showToast("ì¼€í†¤ ìˆ˜ì¹˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });

    // --- ìš´ë™ ê¸°ë¡ ---
    exerciseBtn?.addEventListener('click', () => exerciseModal && (exerciseModal.style.display='flex'));
    exerciseTypeWrap?.addEventListener('click', (e) => {
      if (!e.target.classList.contains('tag')) return;
      const prev = exerciseTypeWrap.querySelector('.tag.active');
      if (prev) prev.classList.remove('active');
      e.target.classList.add('active');
    });
    saveExerciseBtn?.addEventListener('click', async () => {
      const sel = exerciseTypeWrap?.querySelector('.tag.active');
      const duration = parseInt(exerciseDuration?.value,10);
      const calories = exerciseCalories?.value === '' ? null : parseInt(exerciseCalories.value,10);

      if (!sel) return showToast("ìš´ë™ ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
      if (!duration || duration<=0) return showToast("ì˜¬ë°”ë¥¸ ìš´ë™ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”.");
      if (calories !== null && calories < 0) return showToast("ì¹¼ë¡œë¦¬ëŠ” 0 ì´ìƒìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.");

      const user = ensureSignedIn(); if (!user) return;

      const rec = { date:new Date().toISOString(), type: sel.dataset.value, duration, calories };

      // ë¡œì»¬
      saveLocalList('exerciseData', rec);

      // Firestore
      try {
        await db.collection('users').doc(user.uid)
          .collection('measurements').doc('exercise')
          .collection('items').add({
            date: new Date(),
            type: rec.type,
            duration: rec.duration,
            calories: rec.calories ?? 0,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
      } catch (e) {
        console.error('save exercise failed:', e);
        showToast('ì„œë²„ ì €ì¥ ì‹¤íŒ¨(ìš´ë™)â€¦ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }

      sel.classList.remove('active');
      exerciseDuration.value = '';
      exerciseCalories.value = '';
      exerciseModal.style.display = 'none';
      showToast("ìš´ë™ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });

    // ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨
    privacyPolicyLink?.addEventListener('click', (e) => {
      e.preventDefault();
      showToast("ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤. (ê°œë°œ ì¤‘)");
    });

    // data-close ê³µí†µ ë‹«ê¸°
    document.addEventListener('click', (e) => {
      const closeId = e.target?.getAttribute?.('data-close');
      if (closeId) {
        const el = document.getElementById(closeId);
        if (el) el.style.display = 'none';
      }
    });

    // ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ë‹«ê¸°
    window.addEventListener('click', (e) => {
      [timePickerModal, confirmChangeModal, bloodSugarModal, ketoneModal, exerciseModal]
        .filter(Boolean)
        .forEach(modal => { if (e.target === modal) modal.style.display = 'none'; });
    })
    
}
});
</script>
