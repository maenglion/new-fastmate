<script>
    // --- 이메일/비밀번호 로그인 기능 ---
    async function loginWithEmail() {
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const email = emailInput.value;
        const password = passwordInput.value;

        if (!email || !password) {
            alert('이메일과 비밀번호를 모두 입력해주세요.');
            return;
        }

        try {
            // Firebase에 이메일/비밀번호로 로그인 요청
            await firebase.auth().signInWithEmailAndPassword(email, password);
            // 로그인 성공 시 onAuthStateChanged가 감지하여 자동으로 페이지를 이동시킵니다.
            // window.location.href = './fastmate.html'; // 즉시 이동을 원하면 이 줄의 주석을 해제하세요.

        } catch (error) {
            console.error("로그인 실패:", error);
            // 사용자에게 친절한 에러 메시지 표시
            if (error.code === 'auth/user-not-found') {
                alert('가입되지 않은 이메일입니다. 회원가입을 먼저 진행해주세요.');
            } else if (error.code === 'auth/wrong-password') {
                alert('비밀번호가 틀렸습니다.');
            } else {
                alert('로그인에 실패했습니다. 잠시 후 다시 시도해주세요.');
            }
        }
    }

    // --- 페이지 로드 시 실행되는 로직 ---
    document.addEventListener('DOMContentLoaded', () => {
        const googleLoginBtn = document.getElementById('googleLoginBtn');
      
        // [핵심] 로그인 상태 감지 리스너
        // 이미 로그인된 상태거나, 로그인에 성공하면 fastmate.html로 자동 이동
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                console.log('로그인 상태 확인, fastmate.html로 이동합니다.');
                window.location.href = './fastmate.html';
            }
        });

        // --- 구글 로그인 버튼 이벤트 리스너 ---
        googleLoginBtn?.addEventListener('click', async () => {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await firebase.auth().signInWithPopup(provider);
                // 로그인 성공 → 위의 onAuthStateChanged가 감지하여 페이지 이동
            } catch (error) {
                // 계정 연결이 필요한 경우 등 복잡한 에러는 이전 답변 참고
                if (error.code === 'auth/account-exists-with-different-credential') {
                    alert('이미 가입된 이메일입니다. 다른 로그인 방식을 확인해주세요.');
                } else {
                    console.error("구글 로그인 실패:", error);
                    alert('구글 로그인에 실패했습니다.');
                }
            }
        });
    });
</script>
