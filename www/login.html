<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

    <title>Fastmate - 로그인</title>
    
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">

    <link rel="stylesheet" href="./styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">



    <style>
        /* login.html 전용 스타일 */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
            font-family: 'Noto Sans KR', sans-serif;
        }
        .login-container {
            width: 100%;
            max-width: 400px;
            padding: 40px;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            box-sizing: border-box;
            margin: 20px;
        }
        .login-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1c8e3e;
            margin: 0 0 15px 0;
        }
        .login-subtitle {
            font-size: 1rem;
            color: #777;
            margin: 0 0 30px 0;
        }
        .input-group {
            text-align: left;
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        .login-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background-color: #1c8e3e;
            color: white;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            margin-top: 10px;
        }
        .forgot-password {
            display: block;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #555;
            text-decoration: none;
        }
        .forgot-password:hover {
            text-decoration: underline;
        }
        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            color: #aaa;
            margin: 30px 0;
        }
        .divider::before, .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #e0e0e0;
        }
        .divider:not(:empty)::before { margin-right: .5em; }
        .divider:not(:empty)::after { margin-left: .5em; }
        .google-login-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            width: 100%;
            padding: 12px 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #ffffff;
            font-size: 1rem;
            font-weight: 500;
            color: #333;
            cursor: pointer;
        }
        .google-login-btn svg { width: 20px; height: 20px; }
    </style>
</head>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Firebase SDK (compat 버전) -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
    <script src="./firebase-init.js"></script>

    <title>로그인 - fastmate</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>

    <div class="login-container">
        <h2>로그인</h2>
        <div class="input-group">
            <input type="email" id="email" placeholder="이메일 주소">
        </div>
        <div class="input-group">
            <input type="password" id="password" placeholder="비밀번호">
        </div>
        <button id="emailLoginBtn" class="main-button">로그인</button>
        <p class="divider">또는</p>
        <button id="googleLoginBtn" class="social-button google">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Google_%22G%22_logo.svg/800px-Google_%22G%22_logo.svg.png" alt="Google">
            Google로 로그인
        </button>
        <button id="kakaoLoginBtn" class="social-button kakao">
            <!-- 카카오 이미지 URL 수정 -->
            <img src="https://upload.wikimedia.org/wikipedia/commons/e/e3/KakaoTalk_logo.svg" alt="Kakao">
            카카오로 로그인
        </button>
        <p class="signup-link">계정이 없다면 <a href="./signup.html">회원가입하기</a></p>
    </div>
        
<script>
document.addEventListener('DOMContentLoaded', () => {
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const emailLoginBtn = document.getElementById('emailLoginBtn');
    const googleLoginBtn = document.getElementById('googleLoginBtn');
    const kakaoLoginBtn = document.getElementById('kakaoLoginBtn');

    // ========================================
    // [수정 1] 이미 로그인 상태면 fastmate로 이동 (한 곳에서만 처리)
    // ========================================
    let redirected = false;
    auth.onAuthStateChanged((user) => {
        if (user && !redirected) {
            redirected = true;
            window.location.href = './fastmate.html';
        }
    });

    // ========================================
    // 이메일/비밀번호 로그인
    // ========================================
    emailLoginBtn?.addEventListener('click', async () => {
        const email = (emailInput?.value || '').trim();
        const password = passwordInput?.value || '';

        if (!email || !password) {
            alert('이메일과 비밀번호를 입력해주세요.');
            return;
        }

        emailLoginBtn.disabled = true;
        try {
            await auth.signInWithEmailAndPassword(email, password);
            // onAuthStateChanged에서 리디렉션 처리됨
        } catch (e) {
            console.error(e);
            let msg = '로그인에 실패했습니다.';
            if (e.code === 'auth/user-not-found') {
                msg = '등록되지 않은 이메일입니다.';
            } else if (e.code === 'auth/wrong-password') {
                msg = '비밀번호가 올바르지 않습니다.';
            } else if (e.code === 'auth/invalid-email') {
                msg = '이메일 형식이 올바르지 않습니다.';
            } else if (e.code === 'auth/too-many-requests') {
                msg = '로그인 시도가 너무 많습니다. 잠시 후 다시 시도해주세요.';
            }
            alert(msg);
        } finally {
            emailLoginBtn.disabled = false;
        }
    });

    // Enter 키로 로그인
    passwordInput?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            emailLoginBtn?.click();
        }
    });

    // ========================================
    // [수정 2] 구글 로그인 - firebase-init.js의 헬퍼 사용
    // ========================================
    googleLoginBtn?.addEventListener('click', async () => {
        if (googleLoginBtn.disabled) return;
        googleLoginBtn.disabled = true;

        try {
            const user = await signInWithGoogle(); // firebase-init.js 헬퍼
            // 성공 시 onAuthStateChanged에서 fastmate.html로 이동
            if (!user) {
                // 팝업 닫힘 또는 리다이렉트 폴백 진행 중
                console.log('Google 로그인: 팝업 닫힘 또는 리다이렉트 진행 중');
            }
        } catch (e) {
            console.error(e);
            alert(e.message || 'Google 로그인에 실패했습니다.');
        } finally {
            googleLoginBtn.disabled = false;
        }
    });

    // ========================================
    // 카카오 로그인 (준비중)
    // ========================================
    kakaoLoginBtn?.addEventListener('click', () => {
        alert('카카오 로그인은 준비중입니다.');
    });
});
</script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script defer src="/firebase-init.js?v=2025.09.06-v8"></script>


</body>
</html>